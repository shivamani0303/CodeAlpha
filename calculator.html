<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Calculator — HTML CSS JS</title>
  <style>
    :root{
      --bg:#0f1724;
      --panel:#0b1220;
      --accent:#7c5cff;
      --accent-2:#50e3c2;
      --muted:#9aa4b2;
      --glass: rgba(255,255,255,0.04);
      --btn-size: 64px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      display:flex;
      align-items:center;
      justify-content:center;
      background: linear-gradient(180deg, #071025 0%, #0f1724 100%);
      font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      color: #e6eef8;
      padding:24px;
    }

    /* Calculator container */
    .calc {
      width: min(420px, 96vw);
      background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      border-radius: 16px;
      padding: 18px;
      box-shadow: 0 10px 30px rgba(2,6,23,0.6), inset 0 1px 0 rgba(255,255,255,0.02);
      border: 1px solid rgba(255,255,255,0.03);
    }

    /* Header */
    .calc header{
      display:flex;
      justify-content:space-between;
      align-items:center;
      margin-bottom:12px;
    }
    .brand{
      font-weight:700;
      letter-spacing:0.2px;
      display:flex;
      gap:10px;
      align-items:center;
    }
    .dot{width:10px;height:10px;border-radius:50%;background:var(--accent);box-shadow:0 0 18px rgba(124,92,255,0.25)}
    .muted{color:var(--muted);font-size:13px}

    /* Display */
    .display{
      background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      border-radius: 12px;
      padding: 14px 16px;
      min-height: 92px;
      display:flex;
      flex-direction:column;
      justify-content:center;
      gap:8px;
      margin-bottom:14px;
    }
    .history{
      font-size:14px;
      color:var(--muted);
      min-height:18px;
      text-overflow:ellipsis;white-space:nowrap;overflow:hidden
    }
    .output{
      font-size:28px;
      font-weight:600;
      text-align:right;
      word-break:break-all;
    }
    .result-preview{
      font-size:14px;
      color:var(--accent-2);
      text-align:right;
      opacity:0.9;
    }

    /* Buttons grid */
    .keys{
      display:grid;
      grid-template-columns: repeat(4, 1fr);
      gap:10px;
    }
    button.key{
      height: var(--btn-size);
      border-radius:12px;
      border: none;
      background: var(--glass);
      color: inherit;
      font-size:18px;
      cursor:pointer;
      transition: transform 120ms ease, box-shadow 120ms ease, background 220ms ease;
      box-shadow: 0 6px 14px rgba(2,6,23,0.5);
      backdrop-filter: blur(6px);
    }
    button.key:active{transform: translateY(2px) scale(0.998)}
    button.key:hover{transform: translateY(-4px)}

    /* Special buttons */
    .op{background: linear-gradient(180deg, rgba(124,92,255,0.18), rgba(124,92,255,0.12)); color: #fff}
    .wide{grid-column: span 2}
    .danger{background: linear-gradient(180deg, rgba(255,80,80,0.15), rgba(255,80,80,0.1)); color:#ffd6d6}

    /* Small screens tweak */
    @media (max-width:420px){
      :root{--btn-size:56px}
      .output{font-size:22px}
    }

    /* Keyboard hint */
    .hint{font-size:12px;color:var(--muted);text-align:center;margin-top:12px}
  </style>
</head>
<body>
  <main class="calc" role="application" aria-label="Calculator">
    <header>
      <div class="brand"><span class="dot" aria-hidden></span>Calculator</div>
      <div class="muted">HTML • CSS • JavaScript</div>
    </header>

    <section class="display" aria-live="polite">
      <div class="history" id="history">&nbsp;</div>
      <div class="output" id="output">0</div>
      <div class="result-preview" id="preview">&nbsp;</div>
    </section>

    <section class="keys" role="group" aria-label="Calculator keys">
      <button class="key danger" data-action="clear" title="All Clear">AC</button>
      <button class="key" data-action="del" title="Delete">DEL</button>
      <button class="key" data-value="%">%</button>
      <button class="key op" data-value="/">÷</button>

      <button class="key" data-value="7">7</button>
      <button class="key" data-value="8">8</button>
      <button class="key" data-value="9">9</button>
      <button class="key op" data-value="*">×</button>

      <button class="key" data-value="4">4</button>
      <button class="key" data-value="5">5</button>
      <button class="key" data-value="6">6</button>
      <button class="key op" data-value="-">−</button>

      <button class="key" data-value="1">1</button>
      <button class="key" data-value="2">2</button>
      <button class="key" data-value="3">3</button>
      <button class="key op" data-value="+">+</button>

      <button class="key wide" data-value="0">0</button>
      <button class="key" data-value=".">.</button>
      <button class="key op" data-action="equals" title="Equals">=</button>
    </section>

    <div class="hint">You can also use your keyboard (numbers, + - * / Enter Backspace)</div>
  </main>

  <script>
    // Simple, robust calculator logic with real-time preview and keyboard support
    (function(){
      const outputEl = document.getElementById('output');
      const historyEl = document.getElementById('history');
      const previewEl = document.getElementById('preview');
      const keys = document.querySelectorAll('.key');

      let expression = '';

      // Helpers
      const safeEval = (expr) => {
        // Basic sanitization: allow digits, operators, parentheses, dot, percent and spaces only
        if (!expr || /[^0-9+\-*/().%\s]/.test(expr)) return null;
        try {
          // replace percentage like 50% -> (50/100)
          const replaced = expr.replace(/(\d+(?:\.\d+)?)%/g, '($1/100)');
          // Evaluate with Function (safer than eval in some contexts), still only use after sanitization
          // eslint-disable-next-line no-new-func
          const val = Function('return ' + replaced)();
          if (typeof val === 'number' && isFinite(val)) return val;
          return null;
        } catch (e){
          return null;
        }
      };

      const render = () => {
        historyEl.textContent = expression || '\u00A0';
        outputEl.textContent = (expression === '') ? '0' : expression;
        const val = safeEval(expression);
        previewEl.textContent = (val === null) ? '\u00A0' : '= ' + formatNumber(val);
      };

      const formatNumber = (n) => {
        // keep short if very long
        if (Math.abs(n) > 1e12) return n.toExponential(6);
        return Number.isInteger(n) ? String(n) : String(Number(n.toFixed(10))).replace(/(?:\.0+$|0+$)/, '');
      };

      const append = (v) => {
        // prevent multiple operators in a row (except - for negative sign)
        if (/^[+\-*/%]$/.test(v)){
          if (expression === '' && v !== '-') return; // don't start with +,*,/
          if (/[+\-*/%]$/.test(expression)){
            // replace last operator (except allow - after something for negative?)
            expression = expression.slice(0, -1) + v;
            render();
            return;
          }
        }

        // dot rules: prevent more than one dot in current number
        if (v === '.'){
          const parts = expression.split(/[+\-*/%\s]/);
          const last = parts[parts.length-1];
          if (last.includes('.')) return;
        }

        expression += v;
        render();
      };

      const clearAll = () => { expression = ''; render(); };
      const del = () => { expression = expression.slice(0, -1); render(); };
      const equals = () => {
        const val = safeEval(expression);
        if (val === null) {
          // flash invalid
          previewEl.textContent = 'Invalid';
          return;
        }
        expression = String(Number(val));
        render();
      };

      // Wire buttons
      keys.forEach(btn => {
        btn.addEventListener('click', ()=>{
          const v = btn.dataset.value;
          const action = btn.dataset.action;
          if (action === 'clear') return clearAll();
          if (action === 'del') return del();
          if (action === 'equals') return equals();
          if (v) return append(v);
        });
      });

      // Keyboard support
      window.addEventListener('keydown', (e)=>{
        if (e.metaKey || e.ctrlKey) return; // ignore shortcuts
        const key = e.key;
        if (/^[0-9]$/.test(key)) { append(key); e.preventDefault(); return; }
        if (key === '.') { append('.'); e.preventDefault(); return; }
        if (key === 'Backspace') { del(); e.preventDefault(); return; }
        if (key === 'Escape') { clearAll(); e.preventDefault(); return; }
        if (key === 'Enter' || key === '=') { equals(); e.preventDefault(); return; }
        if (key === '+' || key === '-' || key === '*' || key === '/') { append(key); e.preventDefault(); return; }
        if (key === '%') { append('%'); e.preventDefault(); return; }
      });

      // Initialize
      render();
    })();
  </script>
</body>
</html>
